{"ast":null,"code":"import _taggedTemplateLiteral from \"C:/Users/verma/Documents/GitHub/whatsapp-clone-with-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"C:/Users/verma/Documents/GitHub/whatsapp-clone-with-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"C:/Users/verma/Documents/GitHub/whatsapp-clone-with-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\verma\\\\Documents\\\\GitHub\\\\whatsapp-clone-with-nextjs\\\\components\\\\ChatScreen.js\",\n    _s = $RefreshSig$();\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\nmargin-bottom:100px;\\n\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\nheight:90vh;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Avatar, IconButton } from '@material-ui/core';\nimport { useRouter } from 'next/router';\nimport React, { useRef, useState } from 'react';\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport styled from 'styled-components';\nimport { auth, db } from '../firebase';\nimport AttachFileIcon from '@material-ui/icons/AttachFile';\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport { useCollection } from 'react-firebase-hooks/firestore';\nimport Message from './Message';\nimport InsertEmoticonIcon from '@material-ui/icons/InsertEmoticon';\nimport MicIcon from '@material-ui/icons/Mic';\nimport firebase from 'firebase';\nimport getRecipientEmail from '../utils/getRecipientEmail';\nimport TimeAgo from 'timeago-react';\n\nfunction ChatScreen(_ref) {\n  _s();\n\n  var _this = this,\n      _recipientSnapshot$do,\n      _recipientSnapshot$do2,\n      _recipient$lastSeen,\n      _recipient$lastSeen2;\n\n  var chat = _ref.chat,\n      messages = _ref.messages;\n\n  var _useAuthState = useAuthState(auth),\n      _useAuthState2 = _slicedToArray(_useAuthState, 1),\n      user = _useAuthState2[0];\n\n  var endOfMessageRef = useRef(null);\n  var router = useRouter();\n\n  var _useState = useState(\"\"),\n      input = _useState[0],\n      setInput = _useState[1];\n\n  var _useCollection = useCollection(db.collection('chats').doc(router.query.id).collection(\"messages\").orderBy(\"timestamp\", \"asc\")),\n      _useCollection2 = _slicedToArray(_useCollection, 1),\n      messagesSnapshot = _useCollection2[0]; //  console.log(\"i am a problem 1 \", messagesSnapshot);\n\n\n  var _useCollection3 = useCollection(db.collection('users').where(\"email\", \"==\", getRecipientEmail(chat.users, user))),\n      _useCollection4 = _slicedToArray(_useCollection3, 1),\n      recipientSnapshot = _useCollection4[0];\n\n  var showMessage = function showMessage() {\n    if (messagesSnapshot) {\n      return messagesSnapshot.docs.map(function (message) {\n        var _message$data, _message$data$timesta;\n\n        return (\n          /*#__PURE__*/\n          // console.log(message);\n          _jsxDEV(Message, {\n            user: message.data().user,\n            message: _objectSpread(_objectSpread({}, message.data()), {}, {\n              timestamp: (_message$data = message.data()) === null || _message$data === void 0 ? void 0 : (_message$data$timesta = _message$data.timestamp) === null || _message$data$timesta === void 0 ? void 0 : _message$data$timesta.toDate().getTime()\n            })\n          }, message.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 32,\n            columnNumber: 16\n          }, _this)\n        );\n      });\n    } else {\n      //  console.log(messagesSnapshot);\n      return JSON.parse(messages).map(function (message) {\n        return /*#__PURE__*/_jsxDEV(Message, {\n          user: message.user,\n          message: message\n        }, message.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 42,\n          columnNumber: 18\n        }, _this);\n      });\n    }\n  };\n\n  var scrollToBottom = function scrollToBottom() {\n    endOfMessageRef.current.scrollIntoView({\n      behavior: \"smooth\",\n      block: \"start\"\n    });\n  };\n\n  var sendMessage = function sendMessage(e) {\n    e.preventDefault();\n    db.collection('users').doc(user.uid).set({\n      lastSeen: firebase.firestore.FieldValue.serverTimestamp()\n    }, {\n      merge: true\n    });\n    db.collection('chats').doc(router.query.id).collection('messages').add({\n      timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n      message: input,\n      user: user.email,\n      photoURL: user.photoURL\n    });\n    setInput(\"\");\n    scrollToBottom();\n  };\n\n  var recipient = recipientSnapshot === null || recipientSnapshot === void 0 ? void 0 : (_recipientSnapshot$do = recipientSnapshot.docs) === null || _recipientSnapshot$do === void 0 ? void 0 : (_recipientSnapshot$do2 = _recipientSnapshot$do[0]) === null || _recipientSnapshot$do2 === void 0 ? void 0 : _recipientSnapshot$do2.data();\n  var recipientEmail = getRecipientEmail(chat.users, user);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      children: [recipient ? /*#__PURE__*/_jsxDEV(Avatar, {\n        src: recipient === null || recipient === void 0 ? void 0 : recipient.photoUrl\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 24\n      }, this) : /*#__PURE__*/_jsxDEV(Avatar, {\n        children: [\" \", recipientEmail[0], \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 63\n      }, this), /*#__PURE__*/_jsxDEV(HeaderInformation, {\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [\" \", recipientEmail]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 21\n        }, this), recipientSnapshot ? /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Last active:\", ' ', recipient !== null && recipient !== void 0 && (_recipient$lastSeen = recipient.lastSeen) !== null && _recipient$lastSeen !== void 0 && _recipient$lastSeen.toDate() ? /*#__PURE__*/_jsxDEV(TimeAgo, {\n            datetime: recipient === null || recipient === void 0 ? void 0 : (_recipient$lastSeen2 = recipient.lastSeen) === null || _recipient$lastSeen2 === void 0 ? void 0 : _recipient$lastSeen2.toDate()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 37\n          }, this) : \"Unavailable\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 30\n        }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Loading last active\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(HeaderIcons, {\n        children: /*#__PURE__*/_jsxDEV(IconButton, {\n          className: \"mr-20\",\n          children: [/*#__PURE__*/_jsxDEV(AttachFileIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(MoreVertIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(MessageContainer, {\n      className: \"h-screen p-8 bg-red-100\",\n      children: [showMessage(), /*#__PURE__*/_jsxDEV(EndOfMessage, {\n        ref: endOfMessageRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(InputContainer, {\n      children: [/*#__PURE__*/_jsxDEV(InsertEmoticonIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        value: input,\n        onChange: function onChange(e) {\n          return setInput(e.target.value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: !input,\n        type: \"submit\",\n        onClick: sendMessage,\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(MicIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 7\n  }, this);\n}\n\n_s(ChatScreen, \"i76fvJIjDIYuW83EGALKyAsl90o=\", false, function () {\n  return [useAuthState, useRouter, useCollection, useCollection];\n});\n\n_c = ChatScreen;\nexport default ChatScreen;\nvar Container = styled.div.attrs({\n  className: \"h-full overflow-hidden w-full flex-grow\"\n})(_templateObject());\n_c2 = Container;\nvar Header = styled.div.attrs({\n  className: \"sticky bg-white z-50 top-0 flex p-2 h-16 items-center border-b-2 border-gray-200\"\n})(_templateObject2());\n_c3 = Header;\nvar HeaderInformation = styled.div.attrs({\n  className: \"m-2 flex-1\"\n})(_templateObject3());\n_c4 = HeaderInformation;\nvar HeaderIcons = styled.div.attrs({})(_templateObject4());\n_c5 = HeaderIcons;\nvar MessageContainer = styled.div.attrs({\n  className: \"overflow-y-scroll \"\n})(_templateObject5());\n_c6 = MessageContainer;\nvar InputContainer = styled.form.attrs({\n  className: \"flex items-center p-3 sticky bottom-0 bg-white z-50\"\n})(_templateObject6());\n_c7 = InputContainer;\nvar Input = styled.input.attrs({\n  className: \"flex-1 outline-none border-none rounded-xl bg-gray-50 p-2 ml-4 mr-4\"\n})(_templateObject7());\n_c8 = Input;\nvar EndOfMessage = styled.div.attrs({})(_templateObject8());\n_c9 = EndOfMessage;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9;\n\n$RefreshReg$(_c, \"ChatScreen\");\n$RefreshReg$(_c2, \"Container\");\n$RefreshReg$(_c3, \"Header\");\n$RefreshReg$(_c4, \"HeaderInformation\");\n$RefreshReg$(_c5, \"HeaderIcons\");\n$RefreshReg$(_c6, \"MessageContainer\");\n$RefreshReg$(_c7, \"InputContainer\");\n$RefreshReg$(_c8, \"Input\");\n$RefreshReg$(_c9, \"EndOfMessage\");","map":{"version":3,"sources":["C:/Users/verma/Documents/GitHub/whatsapp-clone-with-nextjs/components/ChatScreen.js"],"names":["Avatar","IconButton","useRouter","React","useRef","useState","useAuthState","styled","auth","db","AttachFileIcon","MoreVertIcon","useCollection","Message","InsertEmoticonIcon","MicIcon","firebase","getRecipientEmail","TimeAgo","ChatScreen","chat","messages","user","endOfMessageRef","router","input","setInput","collection","doc","query","id","orderBy","messagesSnapshot","where","users","recipientSnapshot","showMessage","docs","map","message","data","timestamp","toDate","getTime","JSON","parse","scrollToBottom","current","scrollIntoView","behavior","block","sendMessage","e","preventDefault","uid","set","lastSeen","firestore","FieldValue","serverTimestamp","merge","add","email","photoURL","recipient","recipientEmail","photoUrl","target","value","Container","div","attrs","className","Header","HeaderInformation","HeaderIcons","MessageContainer","InputContainer","form","Input","EndOfMessage"],"mappings":"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","sourcesContent":["import { Avatar, IconButton } from '@material-ui/core'\r\nimport { useRouter } from 'next/router'\r\nimport React, { useRef, useState } from 'react'\r\nimport { useAuthState } from 'react-firebase-hooks/auth'\r\nimport styled from 'styled-components'\r\nimport { auth, db } from '../firebase'\r\nimport AttachFileIcon from '@material-ui/icons/AttachFile'\r\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\r\nimport { useCollection } from 'react-firebase-hooks/firestore'\r\nimport Message from './Message'\r\nimport InsertEmoticonIcon from '@material-ui/icons/InsertEmoticon'\r\nimport MicIcon from '@material-ui/icons/Mic'\r\nimport firebase from 'firebase'\r\nimport getRecipientEmail from '../utils/getRecipientEmail'\r\nimport TimeAgo from 'timeago-react';\r\nfunction ChatScreen({ chat, messages }) {\r\n    \r\n    const [user] = useAuthState(auth)\r\n    const endOfMessageRef=useRef(null)\r\n    const router = useRouter();\r\n    const [input, setInput] = useState(\"\")\r\n    const [messagesSnapshot]=useCollection(db.collection('chats').doc(router.query.id).collection(\"messages\").orderBy(\"timestamp\", \"asc\"))\r\n        //  console.log(\"i am a problem 1 \", messagesSnapshot);\r\n    const [recipientSnapshot]=useCollection(db.collection('users').where(\"email\",\"==\", getRecipientEmail(chat.users, user)))\r\n    \r\n    const showMessage = () => {\r\n      \r\n        if (messagesSnapshot) {\r\n           \r\n            return messagesSnapshot.docs.map((message) =>( \r\n                // console.log(message);\r\n               <Message key={message.id} user={message.data().user}\r\n                    message={{\r\n                        ...message.data(),\r\n                        timestamp: message.data()?.timestamp?.toDate().getTime()\r\n                    }}\r\n                />\r\n            ))\r\n        } else {\r\n        //  console.log(messagesSnapshot);\r\n            return JSON.parse(messages).map((message) =>( \r\n                 <Message\r\n                    key={message.id}\r\n                    user={message.user}\r\n                    message={message}\r\n                  />\r\n            ))\r\n        }\r\n    }\r\n\r\n    const scrollToBottom = () => {\r\n        endOfMessageRef.current.scrollIntoView({\r\n            behavior: \"smooth\",\r\n            block:\"start\",\r\n        })\r\n    }\r\n    const sendMessage = (e) => {\r\n        e.preventDefault();\r\n        db.collection('users').doc(user.uid).set({\r\n            lastSeen: firebase.firestore.FieldValue.serverTimestamp(),\r\n        }, { merge: true }\r\n        )\r\n        db.collection('chats').doc(router.query.id).collection('messages').add({\r\n            timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n            message: input,\r\n            user: user.email,\r\n            photoURL: user.photoURL\r\n        })\r\n        setInput(\"\");\r\n        scrollToBottom()\r\n    }\r\n    const recipient=recipientSnapshot?.docs?.[0]?.data()\r\n    const recipientEmail=getRecipientEmail(chat.users, user)\r\n    return (\r\n      <Container>\r\n        <Header>\r\n\r\n          {recipient ? <Avatar src={recipient?.photoUrl} /> : <Avatar > {recipientEmail[0]} </Avatar>}\r\n          <HeaderInformation>\r\n                    <h3> {recipientEmail}</h3>\r\n                    {\r\n                        recipientSnapshot ?\r\n                           ( <p>Last active:{' '}\r\n                                {\r\n                                    recipient?.lastSeen?.toDate() ? (\r\n                                    <TimeAgo datetime={recipient?.lastSeen?.toDate()}/>\r\n                            ): \"Unavailable\" }\r\n                            </p>) :\r\n                            (\r\n                                <p>Loading last active</p>\r\n                            )\r\n                    }\r\n           \r\n          </HeaderInformation>\r\n          <HeaderIcons>\r\n            <IconButton className=\"mr-20\">\r\n              <AttachFileIcon />\r\n              <MoreVertIcon />\r\n            </IconButton>\r\n          </HeaderIcons>\r\n        </Header>\r\n        <MessageContainer className=\"h-screen p-8 bg-red-100\">\r\n          {showMessage()}\r\n          {/* <Message/> */}\r\n          <EndOfMessage ref={endOfMessageRef} />\r\n        </MessageContainer>\r\n        <InputContainer>\r\n      \r\n        <InsertEmoticonIcon />\r\n          <Input value={input} onChange={(e) => setInput(e.target.value)} />\r\n          <button disabled={!input} type=\"submit\" onClick={sendMessage}>\r\n            Send\r\n          </button>\r\n          <MicIcon />\r\n      \r\n        </InputContainer>\r\n      </Container>\r\n    );\r\n}\r\n\r\nexport default ChatScreen\r\n\r\nconst Container = styled.div.attrs({\r\n    className:\"h-full overflow-hidden w-full flex-grow\"\r\n})``;\r\n\r\nconst Header = styled.div.attrs({\r\n    className:\"sticky bg-white z-50 top-0 flex p-2 h-16 items-center border-b-2 border-gray-200\"\r\n})``\r\nconst HeaderInformation = styled.div.attrs({\r\nclassName:\"m-2 flex-1\" \r\n})``;\r\nconst HeaderIcons = styled.div.attrs({})``;\r\nconst MessageContainer = styled.div.attrs({\r\n    className:\"overflow-y-scroll \"\r\n})`\r\nheight:90vh;\r\n`;\r\nconst InputContainer = styled.form.attrs({\r\n\r\n     className:\"flex items-center p-3 sticky bottom-0 bg-white z-50\",\r\n})``;\r\nconst Input = styled.input.attrs({\r\n    className:\"flex-1 outline-none border-none rounded-xl bg-gray-50 p-2 ml-4 mr-4\",\r\n})``;\r\n\r\nconst EndOfMessage = styled.div.attrs({\r\n  \r\n})`\r\nmargin-bottom:100px;\r\n`;"]},"metadata":{},"sourceType":"module"}