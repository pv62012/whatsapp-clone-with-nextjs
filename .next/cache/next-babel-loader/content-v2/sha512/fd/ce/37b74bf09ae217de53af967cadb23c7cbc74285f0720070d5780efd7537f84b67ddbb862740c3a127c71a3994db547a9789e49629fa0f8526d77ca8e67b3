{"ast":null,"code":"import _taggedTemplateLiteral from \"C:/Users/Wait for magic/Documents/GitHub/whatsapp-clone-with-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/Users/Wait for magic/Documents/GitHub/whatsapp-clone-with-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"C:/Users/Wait for magic/Documents/GitHub/whatsapp-clone-with-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Avatar, IconButton } from '@material-ui/core';\nimport { useRouter } from 'next/router';\nimport React, { useRef, useState } from 'react';\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport styled from 'styled-components';\nimport { auth, db } from '../firebase';\nimport AttachFileIcon from '@material-ui/icons/AttachFile';\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport { useCollection } from 'react-firebase-hooks/firestore';\nimport Message from './Message';\nimport InsertEmoticonIcon from '@material-ui/icons/InsertEmoticon';\nimport MicIcon from '@material-ui/icons/Mic';\nimport firebase from 'firebase';\nimport getRecipientEmail from '../utils/getRecipientEmail';\nimport TimeAgo from 'timeago-react';\n\nfunction ChatScreen(_ref) {\n  var _recipientSnapshot$do, _recipientSnapshot$do2, _recipient$lastSeen, _recipient$lastSeen2;\n\n  var chat = _ref.chat,\n      messages = _ref.messages;\n\n  var _useAuthState = useAuthState(auth),\n      _useAuthState2 = _slicedToArray(_useAuthState, 1),\n      user = _useAuthState2[0];\n\n  var endOfMessageRef = useRef(null);\n  var router = useRouter();\n\n  var _useState = useState(\"\"),\n      input = _useState[0],\n      setInput = _useState[1];\n\n  var _useCollection = useCollection(db.collection('chats').doc(router.query.id).collection(\"messages\").orderBy(\"timestamp\", \"asc\")),\n      _useCollection2 = _slicedToArray(_useCollection, 1),\n      messagesSnapshot = _useCollection2[0]; //  console.log(\"i am a problem 1 \", messagesSnapshot);\n\n\n  var _useCollection3 = useCollection(db.collection('users').where(\"email\", \"==\", getRecipientEmail(chat.users, user))),\n      _useCollection4 = _slicedToArray(_useCollection3, 1),\n      recipientSnapshot = _useCollection4[0];\n\n  var showMessage = function showMessage() {\n    //  console.log(\"i am a problenm2 \", messagesSnapshot);\n    if (messagesSnapshot) {\n      //  console.log(\"i am problem 3 \", messagesSnapshot);\n      return messagesSnapshot.docs.map(function (message) {\n        var _message$data, _message$data$timesta;\n\n        // console.log(message);\n        return /*#__PURE__*/_jsx(Message, {\n          user: message.data().user,\n          message: _objectSpread(_objectSpread({}, message.data()), {}, {\n            timestamp: (_message$data = message.data()) === null || _message$data === void 0 ? void 0 : (_message$data$timesta = _message$data.timestamp) === null || _message$data$timesta === void 0 ? void 0 : _message$data$timesta.toDate().getTime()\n          })\n        }, message.id);\n      });\n    } else {\n      //  console.log(messagesSnapshot);\n      console.log(messages);\n      return JSON.parse(messages).map(function (message) {\n        /*#__PURE__*/\n        _jsx(Message, {\n          user: message.user,\n          message: message\n        }, message.id);\n      });\n    }\n  };\n\n  var ScrollToBottom = function ScrollToBottom() {\n    endOfMessageRef.current.scrollIntoView({\n      behavior: \"smooth\",\n      block: \"start\"\n    });\n  };\n\n  var sendMessage = function sendMessage(e) {\n    e.preventDefault();\n    db.collection('users').doc(user.uid).set({\n      lastSeen: firebase.firestore.FieldValue.serverTimestamp()\n    }, {\n      merge: true\n    });\n    db.collection('chats').doc(router.query.id).collection('messages').add({\n      timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n      message: input,\n      user: user.email,\n      photoURL: user.photoURL\n    });\n    setInput(\"\");\n    ScrollToBottom();\n  };\n\n  var recipient = recipientSnapshot === null || recipientSnapshot === void 0 ? void 0 : (_recipientSnapshot$do = recipientSnapshot.docs) === null || _recipientSnapshot$do === void 0 ? void 0 : (_recipientSnapshot$do2 = _recipientSnapshot$do[0]) === null || _recipientSnapshot$do2 === void 0 ? void 0 : _recipientSnapshot$do2.data();\n  var recipientEmail = getRecipientEmail(chat.users, user);\n  return /*#__PURE__*/_jsxs(Container, {\n    children: [/*#__PURE__*/_jsxs(Header, {\n      children: [recipient ? /*#__PURE__*/_jsx(Avatar, {\n        src: recipient === null || recipient === void 0 ? void 0 : recipient.photoUrl\n      }) : /*#__PURE__*/_jsxs(Avatar, {\n        children: [\" \", recipientEmail[0], \" \"]\n      }), /*#__PURE__*/_jsxs(HeaderInformation, {\n        children: [/*#__PURE__*/_jsxs(\"h3\", {\n          children: [\" \", recipientEmail]\n        }), recipientSnapshot ? /*#__PURE__*/_jsxs(\"p\", {\n          children: [\"Last active:\", ' ', recipient !== null && recipient !== void 0 && (_recipient$lastSeen = recipient.lastSeen) !== null && _recipient$lastSeen !== void 0 && _recipient$lastSeen.toDate() ? /*#__PURE__*/_jsx(TimeAgo, {\n            datetime: recipient === null || recipient === void 0 ? void 0 : (_recipient$lastSeen2 = recipient.lastSeen) === null || _recipient$lastSeen2 === void 0 ? void 0 : _recipient$lastSeen2.toDate()\n          }) : \"Unavailable\"]\n        }) : /*#__PURE__*/_jsx(\"p\", {\n          children: \"Loading last active\"\n        })]\n      }), /*#__PURE__*/_jsx(HeaderIcons, {\n        children: /*#__PURE__*/_jsxs(IconButton, {\n          children: [/*#__PURE__*/_jsx(AttachFileIcon, {}), /*#__PURE__*/_jsx(MoreVertIcon, {})]\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(MessageContainer, {\n      className: \"h-screen p-8 bg-red-100\",\n      children: [showMessage(), /*#__PURE__*/_jsx(EndOfMessage, {\n        ref: endOfMessageRef\n      })]\n    }), /*#__PURE__*/_jsxs(InputContainer, {\n      children: [/*#__PURE__*/_jsx(InsertEmoticonIcon, {}), /*#__PURE__*/_jsx(Input, {\n        value: input,\n        onChange: function onChange(e) {\n          return setInput(e.target.value);\n        }\n      }), /*#__PURE__*/_jsx(\"button\", {\n        disabled: !input,\n        onClick: sendMessage,\n        children: \"Send\"\n      }), /*#__PURE__*/_jsx(MicIcon, {})]\n    })]\n  });\n}\n\nexport default ChatScreen;\nvar Container = styled.div.attrs({\n  className: \"h-screen\"\n})(_templateObject());\nvar Header = styled.div.attrs({\n  className: \"sticky bg-white z-100 top-0 flex p-2 h-16 items-center border-b-2 border-gray-200\"\n})(_templateObject2());\nvar HeaderInformation = styled.div.attrs({\n  className: \"m-2 flex-1\"\n})(_templateObject3());\nvar HeaderIcons = styled.div.attrs({})(_templateObject4());\nvar MessageContainer = styled.div.attrs({})(_templateObject5());\nvar InputContainer = styled.div.attrs({\n  className: \"flex items-center p-3 sticky bottom-0 bg-white z-50\"\n})(_templateObject6());\nvar Input = styled.input.attrs({\n  className: \"flex-1 outline-none border-none rounded-xl bg-gray-50 p-2 ml-4 mr-4\"\n})(_templateObject7());\nvar EndOfMessage = styled.div.attrs({\n  className: \"m-10\"\n})(_templateObject8());","map":null,"metadata":{},"sourceType":"module"}